env:
    IMAGE_SUFFIX: "c20250422t130822z-f42f41d13"
    WINDOWS_AMI: "win-server-wsl-${IMAGE_SUFFIX}"

aws_credentials:
  role_arn: arn:aws:iam::449134212816:role/AssumeRoleForGithubRepo
  role_session_name: cirrus # an identifier for the assumed role session
  region: us-east-2 # region to use for calling the STS 


win_test_task:
    name: win_test
    alias: windows_test
    only_if: >-
        $CIRRUS_TAG == '' &&
        $CIRRUS_CHANGE_TITLE !=~ '.*CI:DOCS.*'
    ec2_instance:
        image: "${WINDOWS_AMI}"
        region: us-east-1
        type: m5zn.metal
        platform: windows
    env:
        CIRRUS_WORKING_DIR: "${LOCALAPPDATA}\\cirrus-ci-build"
        CIRRUS_SHELL: powershell
        PATH: "${PATH};C:\\ProgramData\\chocolatey\\bin"
    main_script: |
        .\winmake.ps1 localtest
